#!/bin/bash

shopt -s nullglob
output_file="output.csv"

echo "File Name,Title,Author,Creator,Creator Tool,Producer,Filetype" > "$output_file"

IFS=$'\n'

for file in *.*; do
    file_name=""
    title=""
    author=""
    creator=""
    creator_tool=""
    producer=""
    filetype=""

    if [ -f "$file" ]; then
        # Obtener el tipo de archivo
        filetype=$(file -b --mime-type "$file")
        metadata=$(exiftool -FileName -Title -Author -Creator -CreatorTool -Producer "$file" | grep -E "File Name|Title|Author|Creator|Creator Tool|Producer" | grep -vE '\.csv|\.sh$')
        
				file_name=$(echo "$metadata" | grep "File Name" | cut -d':' -f2- | sed 's/,/-/g')
        title=$(echo "$metadata" | grep "Title" | cut -d':' -f2- | sed 's/,/-/g')
        author=$(echo "$metadata" | grep "Author" | cut -d':' -f2- | sed 's/,/-/g')
        creator=$(echo "$metadata" | grep "Creator" | grep -v "Creator Tool" | cut -d':' -f2- | sed 's/,/-/g')
        creator_tool=$(echo "$metadata" | grep "Creator Tool" | cut -d':' -f2- | sed 's/,/-/g')
        producer=$(echo "$metadata" | grep "Producer" | cut -d':' -f2- | sed 's/,/-/g')

        if [ -n "$author" ] || [ -n "$creator" ] || [ -n "$creator_tool" ] || [ -n "$producer" ]; then
            result="$file_name,$title,$author,$creator,$creator_tool,$producer,$filetype"
            echo -e "$result" >> "$output_file"
        fi
    fi
done

unset IFS